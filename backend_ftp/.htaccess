# httpdocs/.htaccess
# Configuración para una Single Page Application (SPA) como React

# -------------------------------------------------------
# 1. SEGURIDAD BÁSICA DE ARCHIVOS
# -------------------------------------------------------

# Deshabilitar el listado de directorios
Options -Indexes

# Proteger archivos sensibles específicamente por nombre
<Files ".env">
    Require all denied
</Files>

<Files "composer.json">
    Require all denied
</Files>

<Files "composer.lock">
    Require all denied
</Files>

# Proteger archivos sensibles por extensión
<FilesMatch "\.(env|ini|log|sh|inc|engine|install|make|module|profile|theme|info|yml|sql|db|conf|config|bak|backup)$">
    Require all denied
</FilesMatch>

# -------------------------------------------------------
# 2. REGLAS DE REESCRITURA PARA LA SPA (REACT ROUTER)
# -------------------------------------------------------

# Habilitar el motor de reescritura
RewriteEngine On

# --- Reglas específicas para evitar conflictos con archivos reales ---
# (Estas deben ir antes de la regla general de la SPA)

# Permitir acceso directo a archivos específicos de la raíz que NO son index.html
# (sitemap.xml, robots.txt, favicon.ico, etc.)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^(sitemap\.xml|robots\.txt|favicon\.ico|manifest\.json|.*\.(png|jpg|jpeg|gif|svg|webp|ico|pdf))$ - [L]

# --- Regla principal de la SPA ---
# Si la solicitud NO es para un archivo físico o directorio físico,
# y la URL no termina con una extensión de archivo conocida,
# entonces REESCRIBE la solicitud para que cargue index.html.
# Esto permite que React Router maneje la navegación.

# Condición: La solicitud NO es para un archivo físico (-f)
RewriteCond %{REQUEST_FILENAME} !-f
# Condición: La solicitud NO es para un directorio físico (-d)
RewriteCond %{REQUEST_FILENAME} !-d
# Condición: La solicitud NO contiene un punto (evita reescribir archivos con extensión como .css, .js a menos que no existan)
# Esta condición es más flexible y permite que archivos inexistentes con extensión también carguen la SPA
# RewriteCond %{REQUEST_URI} !\.[a-zA-Z0-9]+$ [OR]
# RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|svg|webp|ico|pdf|xml|txt|json)$ [NC]
# Condición combinada más robusta: Si no es archivo/dir físico Y (no tiene extensión O es una extensión de asset pero el archivo no existe)
# Simplifiquémoslo para el caso común de SPA:
# Si no es un archivo o directorio real, reescribe a index.html

# Regla: Cualquier cosa que no sea un archivo o directorio real se reescribe a index.html
RewriteRule ^.*$ /index.html [L,QSA]

# Fin del archivo .htaccess
